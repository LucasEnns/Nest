var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function s(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function h(e,n,i){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const i=e.subscribe(...n);return i.unsubscribe?()=>i.unsubscribe():i}(n,i))}function l(t,e,n=e){return t.set(n),e}function a(t,e){t.appendChild(e)}function u(t,e,n){t.insertBefore(e,n||null)}function o(t){t.parentNode.removeChild(t)}function c(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function d(t){return document.createElement(t)}function f(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function g(t){return document.createTextNode(t)}function p(){return g(" ")}function w(){return g("")}function m(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function v(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $(t){return""===t?void 0:+t}function x(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function _(t,e){t.value=null==e?"":e}let b;function y(t){b=t}const q=[],W=[],A=[],H=[],k=Promise.resolve();let S=!1;function E(t){A.push(t)}let P=!1;const C=new Set;function N(){if(!P){P=!0;do{for(let t=0;t<q.length;t+=1){const e=q[t];y(e),I(e.$$)}for(q.length=0;W.length;)W.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];C.has(e)||(C.add(e),e())}A.length=0}while(q.length);for(;H.length;)H.pop()();S=!1,P=!1,C.clear()}}function I(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(E)}}const O=new Set;function j(t,e){t&&t.i&&(O.delete(t),t.i(e))}function M(t,e,n,i){if(t&&t.o){if(O.has(t))return;O.add(t),undefined.c.push((()=>{O.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function R(t){t&&t.c()}function F(t,n,r){const{fragment:h,on_mount:l,on_destroy:a,after_update:u}=t.$$;h&&h.m(n,r),E((()=>{const n=l.map(e).filter(s);a?a.push(...n):i(n),t.$$.on_mount=[]})),u.forEach(E)}function B(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function T(t,e){-1===t.$$.dirty[0]&&(q.push(t),S||(S=!0,k.then(N)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function J(e,s,r,h,l,a,u=[-1]){const c=b;y(e);const d=s.props||{},f=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:n(),dirty:u,skip_bound:!1};let g=!1;if(f.ctx=r?r(e,d,((t,n,...i)=>{const s=i.length?i[0]:n;return f.ctx&&l(f.ctx[t],f.ctx[t]=s)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](s),g&&T(e,t)),n})):[],f.update(),g=!0,i(f.before_update),f.fragment=!!h&&h(f.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);f.fragment&&f.fragment.l(t),t.forEach(o)}else f.fragment&&f.fragment.c();s.intro&&j(e.$$.fragment),F(e,s.target,s.anchor),N()}y(c)}class L{$destroy(){B(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function V(t){return isNaN(t)?t.includes("/")&&!t.includes(".")?t.split(" ").filter((t=>""!==t)).reduce(((t,e)=>{if(e.includes("/")){let n=e.split("/").filter((t=>""!==t));return t+parseFloat(n[0]/n[1])}return t+parseFloat(e)}),0):t:parseFloat(t)}let G=.375,K=0,Y=[],z={width:49,height:97,margins:.25,max_width:()=>z.width-2*z.margins+G,max_height:()=>z.height-2*z.margins+G};function D(t,e=1,n=!1,i=G,s=K,r=z){Y=[];const h=new tt(function(t,e=","){for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[[]],s=null;s=n.exec(t);){var r=s[1];if(r.length&&r!=e&&i.push([]),s[2])var h=s[2].replace(new RegExp('""',"g"),'"');else h=s[3];/\d/.test(h)&&(h=V(h)),i[i.length-1].push(h)}return i.filter((t=>t.filter((t=>""!==t)).length))}(t).slice(e).flatMap((t=>function([t,e,n,i]){let s=1,r=[];for(;e>=s;)r.push([`${t} (${s}/${e})`,parseFloat(n),parseFloat(i)]),s++;return r}(t).map((t=>new U(t)))))).flat().filterTooBig();function l(t){let e=new tt(t.widest().place()),n=e[0].width;for(;t.fitsColumn(e);){let i=new tt(t.fitsColumn(e).place());for(;t.fitsRow(i,n);)i.push(t.fitsRow(i,n).place());1===i.length?e.push(i[0]):e.push(i)}return e.ascendingWidth()}function a(t){let e=new tt(t.widest().place());for(;t.fitsSheet(e);)e.push(t.fitsSheet(e).place());return e}function u(t,e){let n=z.margins+z.width*e,i=z.margins,s=new tt;t.forEach(((e,r)=>{0===r?s.push(n):s.push(s.last()+t[r-1].width);let h=new tt;e.group.forEach(((t,e,n)=>{0===e?h.push(i):n[e-1]instanceof tt?h.push(h.last()+n[e-1].filledHeight()):h.push(h.last()+n[e-1].height),t instanceof U?(t.x0=s[r],t.y0=h[e]):t.forEach(((n,i)=>{n.x0=0===i?s[r]:t[i-1].x0+t[i-1].width,n.y0=h[e]}))}))}))}return G=i,K=s,z.width=r.width,z.height=r.height,z.margins=r.margins,[h,function(t){let e=function(t){let e=new tt;for(;t.notPlaced().length>0;){let n=l(t);e.push(new X(n.columnWidth(),n.columnHeight(),n.columnArea(),n))}return e}(t),n=new tt;for(;e.notPlaced().length>0;){let t=a(e);u(t,n.length),n.push(new Z(t.filledWidth(),t.filledHeight(),t.filledArea(),t.map((t=>t.group)).flatten(2),t,n.length+1))}return n}(h),Y]}class Q{constructor(){this.placed=!1}place(){return this.placed=!0,this}}class U extends Q{constructor([t,e,n]){super(),this.id=t,this.width=e+G+K,this.height=n+G+K,this.area=this.height*this.width,this.x0=0,this.y0=0}}class X extends Q{constructor(t,e,n,i){super(),this.width=t,this.height=e,this.area=n,this.group=i}}class Z extends X{constructor(t,e,n,i,s,r){super(t,e,n,i),this.columns=s,this.sheet_width=z.width,this.sheet_height=z.height,this.sheet_area=z.width*z.height,this.waste_area=this.sheet_area-this.area,this.waste_ratio=1-this.area/this.sheet_area,this.id="Sheet "+r,delete this.placed}}class tt extends Array{first(){return this[0]}last(){return this[this.length-1]}flatten(t=1){let e=this;for(;t--;)e=e.flat();return e}shuffle(){return this.length<3?this:new tt(...this.slice(1),this.first())}ascendingWidth(){return new tt(...this).sort(((t,e)=>e.width!=t.width?e.width-t.width:e.height-t.height))}ascendingHeight(){return new tt(...this).sort(((t,e)=>e.height!=t.height?e.height-t.height:e.width-t.width))}filterTooBig(){return this.map((t=>t.width>z.max_width()||t.height>z.max_height()?(Y.push(`Panel ${t.id} is too big`),!1):t)).filter((t=>t))}notPlaced(){return this.filter((t=>!t.placed))}widest(){return this.notPlaced().ascendingWidth().first()}narrowest(){return this.notPlaced().ascendingWidth().last()}tallest(){return this.notPlaced().ascendingHeight().first()}shortest(){return this.notPlaced().ascendingHeight().last()}biggest(){return this.sort(((t,e)=>e.area-t.area)).notPlaced().first()}totalWidth(){return this.reduce(((t,e)=>e instanceof tt?t+e.ascendingWidth().first().width:t+e.width),0)}totalHeight(){return this.reduce(((t,e)=>e instanceof tt?t+e.ascendingHeight().first().height:t+e.height),0)}totalArea(){return this.reduce(((t,e)=>t+e.area),0)}columnWidth(){return this.flat().ascendingWidth().first().width}columnHeight(){return this.totalHeight()}columnArea(){return this.flat().totalArea()}filledHeight(){return this.ascendingHeight().first().height}filledWidth(){return this.totalWidth()}filledArea(){return this.flat().totalArea()}remainingWidth(t){return t-this.totalWidth()}remainingHeight(t){return t-this.totalHeight()}fitsColumn(t,e=z.height){return this.notPlaced().filter((e=>e.width<=t[0].width)).filter((n=>n.height<t.remainingHeight(e))).widest()}fitsRow(t,e){return this.notPlaced().filter((e=>e.height<=t[0].height)).filter((n=>n.width<t.remainingWidth(e))).widest()}fitsSheet(t,e=z.width){return this.notPlaced().filter((n=>n.width<t.remainingWidth(e))).widest()}}const et=[];const nt=(e,n)=>{const i=t=>JSON.stringify(t,null,2),s=JSON.parse;null===localStorage.getItem(e)&&localStorage.setItem(e,i(n));const h=s(localStorage.getItem(e)),{subscribe:l,set:a,update:u}=function(e,n=t){let i;const s=[];function h(t){if(r(e,t)&&(e=t,i)){const t=!et.length;for(let t=0;t<s.length;t+=1){const n=s[t];n[1](),et.push(n,e)}if(t){for(let t=0;t<et.length;t+=2)et[t][0](et[t+1]);et.length=0}}}return{set:h,update:function(t){h(t(e))},subscribe:function(r,l=t){const a=[r,l];return s.push(a),1===s.length&&(i=n(h)||t),r(e),()=>{const t=s.indexOf(a);-1!==t&&s.splice(t,1),0===s.length&&(i(),i=null)}}}}(h);return{subscribe:l,set:t=>(localStorage.setItem(e,i(t)),a(t)),update:u}},it=nt("panels",[]),st=nt("sheets",[{sheet_width:49,sheet_height:97}]),rt=nt("errors",[]);function ht(e){let n,s,r,h,l,c,f,w,b,y,q,W,A,H,k,S,E,P,C,N,I,O,j,M,R,F,B,T,J,L,V,G,K,Y,z,D,Q,U,X,Z=(""==e[1]?"Open":e[1])+"";return{c(){n=d("div"),s=d("input"),r=p(),h=d("label"),l=g(Z),c=p(),f=d("img"),b=p(),y=d("div"),q=d("h5"),q.textContent="Material W x H",W=p(),A=d("input"),H=p(),k=d("span"),k.textContent="x",S=p(),E=d("input"),P=p(),C=d("div"),N=d("h5"),N.textContent="Margins",I=p(),O=d("input"),j=p(),M=d("div"),R=d("h5"),R.textContent="Kerf",F=p(),B=d("input"),T=p(),J=d("div"),L=d("h5"),L.textContent="Gap",V=p(),G=d("input"),K=p(),Y=d("div"),z=d("h5"),z.textContent="Metric",D=p(),Q=d("input"),v(s,"class","inputfile svelte-118u7vq"),v(s,"name","file"),v(s,"id","file"),v(s,"type","file"),f.src!==(w="./favicon.png")&&v(f,"src","./favicon.png"),v(f,"alt","open csv file"),v(f,"class","svelte-118u7vq"),v(h,"for","file"),v(h,"class","svelte-118u7vq"),v(n,"class","upload-wrapper svelte-118u7vq"),v(q,"class","svelte-118u7vq"),v(A,"class","input svelte-118u7vq"),v(A,"type","number"),v(k,"class","svelte-118u7vq"),v(E,"class","input svelte-118u7vq"),v(E,"type","number"),v(y,"class","input-wrapper svelte-118u7vq"),v(N,"class","svelte-118u7vq"),v(O,"class","input svelte-118u7vq"),v(O,"type","number"),v(O,"step","0.005"),v(C,"class","input-wrapper svelte-118u7vq"),v(R,"class","svelte-118u7vq"),v(B,"class","input svelte-118u7vq"),v(B,"type","number"),v(B,"step","0.005"),v(M,"class","input-wrapper svelte-118u7vq"),v(L,"class","svelte-118u7vq"),v(G,"class","input svelte-118u7vq"),v(G,"type","number"),v(G,"step","0.005"),v(J,"class","input-wrapper svelte-118u7vq"),v(z,"class","svelte-118u7vq"),v(Q,"class","input svelte-118u7vq"),v(Q,"type","checkbox"),v(Y,"class","input-wrapper svelte-118u7vq")},m(t,i){u(t,n,i),a(n,s),e[7](s),a(n,r),a(n,h),a(h,l),a(h,c),a(h,f),u(t,b,i),u(t,y,i),a(y,q),a(y,W),a(y,A),_(A,e[2].width),a(y,H),a(y,k),a(y,S),a(y,E),_(E,e[2].height),u(t,P,i),u(t,C,i),a(C,N),a(C,I),a(C,O),_(O,e[2].margins),u(t,j,i),u(t,M,i),a(M,R),a(M,F),a(M,B),_(B,e[3]),u(t,T,i),u(t,J,i),a(J,L),a(J,V),a(J,G),_(G,e[4]),u(t,K,i),u(t,Y,i),a(Y,z),a(Y,D),a(Y,Q),Q.checked=e[5],U||(X=[m(s,"change",e[6]),m(A,"input",e[8]),m(E,"input",e[9]),m(O,"input",e[10]),m(B,"input",e[11]),m(G,"input",e[12]),m(Q,"change",e[13])],U=!0)},p(t,[e]){2&e&&Z!==(Z=(""==t[1]?"Open":t[1])+"")&&x(l,Z),4&e&&$(A.value)!==t[2].width&&_(A,t[2].width),4&e&&$(E.value)!==t[2].height&&_(E,t[2].height),4&e&&$(O.value)!==t[2].margins&&_(O,t[2].margins),8&e&&$(B.value)!==t[3]&&_(B,t[3]),16&e&&$(G.value)!==t[4]&&_(G,t[4]),32&e&&(Q.checked=t[5])},i:t,o:t,d(t){t&&o(n),e[7](null),t&&o(b),t&&o(y),t&&o(P),t&&o(C),t&&o(j),t&&o(M),t&&o(T),t&&o(J),t&&o(K),t&&o(Y),U=!1,i(X)}}}function lt(t,e,n){let i,s,r,a,u,o,c,d,f;return h(t,it,(t=>n(14,i=t))),h(t,st,(t=>n(15,s=t))),h(t,rt,(t=>n(16,r=t))),n(1,u=""),n(2,o={width:49,height:97,margins:.25}),n(3,c=.375),n(4,d=0),n(5,f=!1),[a,u,o,c,d,f,function(){let t=a.files[0],e=new FileReader;n(1,u=t.name.replace(".csv","")),"text/csv"===t.type?e.onload=function(t){let e=D(t.target.result,4,f,c,d,o);l(it,i=e[0]),l(st,s=e[1]),l(rt,r=e[2]),r.length&&alert(r)}:n(1,u="file.💩"),e.readAsText(t)},function(t){W[t?"unshift":"push"]((()=>{a=t,n(0,a)}))},function(){o.width=$(this.value),n(2,o)},function(){o.height=$(this.value),n(2,o)},function(){o.margins=$(this.value),n(2,o)},function(){c=$(this.value),n(3,c)},function(){d=$(this.value),n(4,d)},function(){f=this.checked,n(5,f)}]}class at extends L{constructor(t){super(),J(this,t,lt,ht,r,{})}}function ut(t,e,n){const i=t.slice();return i[4]=e[n],i}function ot(t,e,n){const i=t.slice();return i[7]=e[n],i[9]=n,i}function ct(t){let e,n,i,s,r;return{c(){e=f("rect"),v(e,"class","sheet svelte-1pd2w2x"),v(e,"id",n=t[7].id),v(e,"x",i=t[9]*t[7].sheet_width+"in"),v(e,"y","0"),v(e,"width",s=t[7].sheet_width+"in"),v(e,"height",r=t[7].sheet_height+"in")},m(t,n){u(t,e,n)},p(t,h){2&h&&n!==(n=t[7].id)&&v(e,"id",n),2&h&&i!==(i=t[9]*t[7].sheet_width+"in")&&v(e,"x",i),2&h&&s!==(s=t[7].sheet_width+"in")&&v(e,"width",s),2&h&&r!==(r=t[7].sheet_height+"in")&&v(e,"height",r)},d(t){t&&o(e)}}}function dt(t){let e,n,i,s,r,h,l;return{c(){e=f("rect"),v(e,"class","panel svelte-1pd2w2x"),v(e,"id","panel"),v(e,"x",n=t[4].x0+"in"),v(e,"y",i=t[4].y0+"in"),v(e,"width",s=t[4].width+"in"),v(e,"height",r=t[4].height+"in")},m(t,n){u(t,e,n),h||(l=m(e,"click",gt),h=!0)},p(t,h){8&h&&n!==(n=t[4].x0+"in")&&v(e,"x",n),8&h&&i!==(i=t[4].y0+"in")&&v(e,"y",i),8&h&&s!==(s=t[4].width+"in")&&v(e,"width",s),8&h&&r!==(r=t[4].height+"in")&&v(e,"height",r)},d(t){t&&o(e),h=!1,l()}}}function ft(e){let n,i,s,r=e[1],h=[];for(let t=0;t<r.length;t+=1)h[t]=ct(ot(e,r,t));let l=e[3],d=[];for(let t=0;t<l.length;t+=1)d[t]=dt(ut(e,l,t));return{c(){n=f("svg");for(let t=0;t<h.length;t+=1)h[t].c();i=w();for(let t=0;t<d.length;t+=1)d[t].c();v(n,"version","1.1"),v(n,"xmlns","http://www.w3.org/2000/svg"),v(n,"xmlns:xlink","http://www.w3.org/1999/xlink"),v(n,"viewBox",s="0 0 "+96*e[0]+" "+96*e[2]),v(n,"preserveAspectRatio","xMidYMid meet"),v(n,"class","svelte-1pd2w2x")},m(t,e){u(t,n,e);for(let t=0;t<h.length;t+=1)h[t].m(n,null);a(n,i);for(let t=0;t<d.length;t+=1)d[t].m(n,null)},p(t,[e]){if(2&e){let s;for(r=t[1],s=0;s<r.length;s+=1){const l=ot(t,r,s);h[s]?h[s].p(l,e):(h[s]=ct(l),h[s].c(),h[s].m(n,i))}for(;s<h.length;s+=1)h[s].d(1);h.length=r.length}if(8&e){let i;for(l=t[3],i=0;i<l.length;i+=1){const s=ut(t,l,i);d[i]?d[i].p(s,e):(d[i]=dt(s),d[i].c(),d[i].m(n,null))}for(;i<d.length;i+=1)d[i].d(1);d.length=l.length}5&e&&s!==(s="0 0 "+96*t[0]+" "+96*t[2])&&v(n,"viewBox",s)},i:t,o:t,d(t){t&&o(n),c(h,t),c(d,t)}}}function gt(){alert(`width: ${this.width.baseVal.valueAsString}\nheight: `+this.height.baseVal.valueAsString)}function pt(t,e,n){let i,s,r,l;return h(t,st,(t=>n(1,i=t))),h(t,it,(t=>n(3,s=t))),t.$$.update=()=>{2&t.$$.dirty&&n(0,r=i.length*i[0].sheet_width||49),2&t.$$.dirty&&n(2,l=i.sheet_height||97)},[r,i,l,s]}class wt extends L{constructor(t){super(),J(this,t,pt,ft,r,{})}}function mt(t,e,n){const i=t.slice();return i[3]=e[n],i[5]=n,i}function vt(t){let e,n,i,s,r,h,l,c,f,w,m,v,$,_,b,y,q=t[3].id+"",W=t[3].sheet_area+"",A=parseInt(t[3].area)+"",H=parseInt(100*t[3].waste_ratio)+"";return{c(){e=d("div"),n=d("h5"),i=g(q),s=p(),r=d("p"),h=g("total area: "),l=g(W),c=p(),f=d("p"),w=g("used area: "),m=g(A),v=p(),$=d("p"),_=g("waste %: "),b=g(H),y=p()},m(t,o){u(t,e,o),a(e,n),a(n,i),a(e,s),a(e,r),a(r,h),a(r,l),a(e,c),a(e,f),a(f,w),a(f,m),a(e,v),a(e,$),a($,_),a($,b),a(e,y)},p(t,e){1&e&&q!==(q=t[3].id+"")&&x(i,q),1&e&&W!==(W=t[3].sheet_area+"")&&x(l,W),1&e&&A!==(A=parseInt(t[3].area)+"")&&x(m,A),1&e&&H!==(H=parseInt(100*t[3].waste_ratio)+"")&&x(b,H)},d(t){t&&o(e)}}}function $t(e){let n,i=e[0],s=[];for(let t=0;t<i.length;t+=1)s[t]=vt(mt(e,i,t));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();n=w()},m(t,e){for(let n=0;n<s.length;n+=1)s[n].m(t,e);u(t,n,e)},p(t,[e]){if(1&e){let r;for(i=t[0],r=0;r<i.length;r+=1){const h=mt(t,i,r);s[r]?s[r].p(h,e):(s[r]=vt(h),s[r].c(),s[r].m(n.parentNode,n))}for(;r<s.length;r+=1)s[r].d(1);s.length=i.length}},i:t,o:t,d(t){c(s,t),t&&o(n)}}}function xt(t,e,n){let i,s,r;return h(t,st,(t=>n(0,i=t))),t.$$.update=()=>{1&t.$$.dirty&&(s=i.length*i[0].sheet_width||49),1&t.$$.dirty&&(r=i.sheet_height||97)},[i]}class _t extends L{constructor(t){super(),J(this,t,xt,$t,r,{})}}function bt(e){let n,i,s,r,h,l,c,f,g,w;return s=new at({}),l=new wt({}),g=new _t({}),{c(){n=d("div"),i=d("div"),R(s.$$.fragment),r=p(),h=d("div"),R(l.$$.fragment),c=p(),f=d("div"),R(g.$$.fragment),v(i,"class","import svelte-a9ho5j"),v(h,"class","viewer svelte-a9ho5j"),v(f,"class","info svelte-a9ho5j"),v(n,"class","container svelte-a9ho5j")},m(t,e){u(t,n,e),a(n,i),F(s,i,null),a(n,r),a(n,h),F(l,h,null),a(n,c),a(n,f),F(g,f,null),w=!0},p:t,i(t){w||(j(s.$$.fragment,t),j(l.$$.fragment,t),j(g.$$.fragment,t),w=!0)},o(t){M(s.$$.fragment,t),M(l.$$.fragment,t),M(g.$$.fragment,t),w=!1},d(t){t&&o(n),B(s),B(l),B(g)}}}return new class extends L{constructor(t){super(),J(this,t,null,bt,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
